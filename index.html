<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>Compare ‚Äî FareComparator</title>
<!--    <link rel="stylesheet" href="compare.css" />-->
    <style>
        @import url("https://fonts.googleapis.com/css2?family=Alfa+Slab+One&family=Geom:ital,wght@0,300..900;1,300..900&family=Google+Sans+Code:ital,wght@0,300..800;1,300..800&family=Oregano:ital@0;1&family=Raleway:ital,wght@0,100..900;1,100..900&family=Roboto+Mono:ital,wght@0,100..700;1,100..700&family=Unbounded:wght@200..900&display=swap");
        :root {
          --primary: #2563eb;
          --bg: #e7e6e3;
          --card: #fff;
          --muted: #6b7280;
          --scrollbar-width: 0px;
        }
        * {
          box-sizing: border-box;
        }
        body {
          margin: 0;
          font-family: system-ui, Segoe UI, Roboto, Arial;
          color: #111827;
        }
        .app-nav {
          background: #0f1225;
          color: #fff;
          padding: 0.75rem 1.5rem;
          display: flex;
          align-items: center;
          justify-content: space-between;
          height: 76px;
          position: sticky;
          top: 0;
          z-index: 1000;
        }
        .app-brand {
          font-weight: 600;
        }
        .app-nav-links {
          padding-right: 140px;
          font-size: 16px;
          display: flex;
          gap: 1.5rem;
        }
        .app-nav-links a {
          color: rgba(255, 255, 255, 0.823);
          text-decoration: none;
          position: relative;
          padding: 0.5rem 0;
          transition: all 0.3s ease;
        }
        .app-nav-links a:hover {
          color: rgba(255, 255, 255, 1);
        }
        .app-nav-links a::after {
          content: "";
          position: absolute;
          width: 0;
          height: 2px;
          bottom: 0;
          left: 0;
          background: #a992df;
          transition: width 0.3s ease;
          border-radius: 1px;
        }
        .app-nav-links a:hover::after {
          width: 100%;
        }
        .app-nav-links a.active {
          color: #a992df;
          font-weight: 500;
        }
        .app-nav-links a.active::after {
          width: 100%;
          background: #a992df;
        }
        .card {
          background: rgba(255, 255, 255, 0.85);
          backdrop-filter: blur(12px);
          border-radius: 12px;
          padding: 1rem;
          border: 1px solid #e6e9ef;
          box-shadow: 0 8px 20px rgba(15, 23, 42, 0.06);
          margin-bottom: 1rem;
        }
        .card-header {
          display: flex;
          justify-content: space-between;
          align-items: flex-start;
        }
        .card-title {
          margin: 0;
          padding: 0;
        }
        .text-muted {
          color: var(--muted);
          font-size: 0.9rem;
        }
        .columns-grid {
          display: grid;
          gap: 0.6rem;
          grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
          width: 100%;
          align-items: start;
        }
        .column h3 {
          text-align: center;
          font-size: 1.1rem;
          margin: 0 0 0.5rem 0;
          font-weight: 600;
        }
        .provider-card {
          background: #fff;
          border-radius: 10px;
          padding: 0.6rem 0.6rem 0.8rem 0.6rem;
          border: 1px solid #eef2f6;
          display: flex;
          flex-direction: column;
          gap: 0.2rem;
          transition: transform 0.25s, box-shadow 0.15s;
          margin-bottom: 0.3rem;
          cursor: pointer;
          height: auto;
          width: 100%;
          box-sizing: border-box;
          overflow: hidden;
        }
        .provider-card:hover {
          transform: translateY(-2px);
          box-shadow: 0 6px 15px rgba(15, 23, 42, 0.05);
        }
        .provider-card.walk {
          background: #f0fdf4;
          border: 1px solid transparent;
          height: auto;
        }
        .provider-card.selected {
          border: 2px solid #007bff !important;
          box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.15);
        }
        .provider-card.confirmed {
          border: 2px solid #16a34a !important;
          box-shadow: 0 0 0 2px rgba(22, 163, 74, 0.15);
        }
        .surge {
          background: #fee2e2;
          color: #b91c1c;
          padding: 0.2rem 0.4rem;
          border-radius: 999px;
          font-size: 0.7rem;
        }
        .provider-name {
          font-weight: 600;
          font-size: 0.95rem;
        }
        .fare {
          font-size: 1.1rem;
          font-weight: 700;
        }
        .eta {
          font-size: 0.85rem;
          color: var(--muted);
        }
        @media (max-width: 900px) {
          .columns-grid {
            grid-template-columns: repeat(auto-fit, minmax(130px, 1fr));
          }
        }
        @media (max-width: 600px) {
          .columns-grid {
            grid-template-columns: 1fr;
          }
        }
        .disclaimer-wrapper {
          margin-top: 1rem;
          display: flex;
          align-items: flex-start;
          gap: 0.75rem;
          position: relative;
        }
        /* Improved "i" button */
        .info-circle {
          width: 28px;
          height: 28px;
          border-radius: 50%;
          background: #e0e7ff;
          color: #4338ca;
          font-weight: 700;
          font-size: 0.95rem;
          cursor: pointer;
          display: flex;
          align-items: center;
          justify-content: center;
          flex-shrink: 0; /* Prevents shrinking */
          transition: background 0.2s ease;
        }
        .info-circle:hover {
          background: #c7d2fe;
        }
        .disclaimer-box {
          background: #f8fafc;
          border: 1px solid #e5e7eb;
          border-radius: 10px;
          padding: 0.75rem 1rem;
          position: absolute;
          left: 40px;
          top: 0;
          z-index: 10;
          min-width: 320px;
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        .hidden {
          display: none;
        }
        .best-badge {
          margin-left: 0.4rem;
          padding: 0.1rem 0.4rem;
          font-size: 0.65rem;
          font-weight: 600;
          border-radius: 999px;
          background: #dcfce7;
          color: #166534;
          vertical-align: middle;
        }
        .fastest-icon {
          margin-left: 0.35rem;
          font-size: 0.75rem;
          color: #2563eb;
          vertical-align: middle;
        }
        .demo-buttons {
          display: flex;
          flex-wrap: wrap;
          gap: 0.8rem;
        }
        .demo-btn {
          font-size: 0.85rem;
          padding: 0.6rem 1.2rem;
          background: #f3f4f6;
          border: 1px solid #d1d5db;
          border-radius: 8px;
          color: #374151;
          font-weight: 500;
          cursor: pointer;
          transition: all 0.2s ease;
          font-family: inherit;
        }
        .demo-btn:hover {
          background: #2563eb;
          color: white;
          border-color: #2563eb;
          transform: translateY(-1px);
          box-shadow: 0 2px 8px rgba(37, 99, 235, 0.2);
        }
        .demo-btn:active {
          transform: translateY(0);
        }
        .walk-message {
          text-align: center;
          padding: 1rem;
          color: #6b7280;
          font-weight: 600;
        }

        /* HERO SECTION */
        .hero-section {
          position: relative;
          overflow: hidden;
          height: 90vh;
        }
        .hero-box {
          width: 100%;
          display: flex;
          flex-direction: column;
          align-items: center;
          text-align: center;
          padding: 0vh 30vw;
          z-index: 100;
        }
        .hero-title {
          font-size: 2rem;
          font-weight: 700;
          line-height: 1.25;
          z-index: 100;
          margin-top: 15vh;
        }
        .hero-title span {
          color: #2563eb;
        }
        .hero-form {
          width: 100%;
          display: flex;
          flex-direction: column;
          gap: 0.8rem;
        }
        .input-wrapper {
          position: relative;
        }
        .input-wrapper input {
          width: 100%;
          height: 63px;
          padding: 1rem 1rem 1rem 3rem;
          border: 1px solid #000000;
          border-radius: 10px;
          font-size: 1.1rem;
          background: rgb(255, 255, 255);
          transition: all 0.3s ease;
        }
        .input-wrapper input:focus {
          outline: none;
          border-color: #3b82f6;
          box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
        }
        .input-icon {
          position: absolute;
          left: 1rem;
          top: 50%;
          transform: translateY(-50%);
          color: #6b7280;
          pointer-events: none;
          transition: color 0.3s ease;
        }
        .input-wrapper input:focus + .input-icon,
        .input-wrapper input:not(:placeholder-shown) + .input-icon {
          color: #3b82f6;
        }
        .hero-btn {
          padding: 1.1rem 3rem;
          font-size: 1.15rem;
          font-weight: 700;
          background: #3b82f6;
          color: white;
          border: none;
          border-radius: 10px;
          cursor: pointer;
          transition: background 0.3s ease;
          margin-top: 1.2rem;
        }
        .hero-btn:hover {
          background: #1d4ed8;
        }
        #world {
          position: absolute;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          pointer-events: none;
          z-index: -1;
          overflow: hidden;
        }
        #world.hide {
          display: none;
        }
        #trail-canvas {
          width: 100%;
          height: 100%;
          display: block;
          background: transparent;
        }
        #resultsSection {
          scroll-margin-top: 86px;
        } /* Adjusted for minimal gap after navbar */
        body.lock-scroll {
          height: 100vh;
          overflow: hidden;
        }
        .app-logo {
          height: 32px;
          width: auto;
          display: block;
          padding-left: 140px;
        }
        .app-brand {
          display: flex;
          align-items: center;
          gap: 12px;
          font-weight: bold;
        }
        #bgHint {
          position:absolute;
          right: 25px;
          bottom: 25px;
          z-index: 101;
          font-weight: 100;
          pointer-events: none;
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          font-size: 14px;
        }
        #bgHint.hide {
          opacity: 0;
          transform: translateY(10px);
        }

        /* NEW LAYOUT STRUCTURE */
        .results-main-row {
          display: flex;
          gap: 1.5rem;
          margin: 0.5rem 1rem 1.5rem 1rem;
          align-items: stretch;
        }
        .providers-wrapper {
          flex: 1;
          display: flex;
          flex-direction: column;
        }
        .map-wrapper {
          flex: 1;
          display: flex;
          flex-direction: column;
        }
        .vertical-divider {
          width: 1px;
          background: #ddd;
          margin: 0 0.5rem;
        }
        .quick-demo-section {
          margin: 0 1rem 2rem 1rem;
          max-width: 800px;
          margin-left: auto;
          margin-right: auto;
        }

        /* Updated Confirm Button */
        #confirmChoiceBtn {
          background: #2563eb;
          color: white;
          border: none;
          padding: 0.5rem 1.1rem;
          border-radius: 8px;
          font-weight: 600;
          font-size: 0.95rem;
          cursor: pointer;
          transition: all 0.3s ease;
          box-shadow: 0 2px 8px rgba(37, 99, 235, 0.2);
          font-family: inherit;
          position: relative;
          overflow: hidden;
        }
        #confirmChoiceBtn:hover:not(:disabled) {
          background: #1d4ed8;
          box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
        }
        #confirmChoiceBtn:disabled {
          background: #9ca3af;
          cursor: not-allowed;
          box-shadow: none;
          transform: none;
        }
        #confirmChoiceBtn:active:not(:disabled) {
          transform: translateY(0);
        }

        /* New Choice Saved Animation */
        #choiceSavedOverlay {
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background: rgba(0, 0, 0, 0.7);
          backdrop-filter: blur(8px);
          display: none;
          align-items: center;
          justify-content: center;
          z-index: 1002;
          opacity: 0;
          transition: opacity 0.4s ease;
        }
        #choiceSavedOverlay.show {
          display: flex;
          opacity: 1;
        }
        .saved-card {
          background: white;
          border-radius: 16px;
          padding: 2.5rem;
          width: 420px;
          text-align: center;
          box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
          transform: scale(0.9) translateY(20px);
          opacity: 0;
          transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        #choiceSavedOverlay.show .saved-card {
          transform: scale(1) translateY(0);
          opacity: 1;
        }
        .saved-icon {
          font-size: 3.5rem;
          margin-bottom: 1.5rem;
          color: #16a34a;
          display: inline-block;
        }
        .saved-title {
          font-size: 1.5rem;
          font-weight: 700;
          color: #111827;
          margin-bottom: 1rem;
        }
        .saved-details {
          font-size: 1rem;
          color: #4b5563;
          line-height: 1.5;
          margin-bottom: 1.8rem;
          padding: 0 0.5rem;
        }
        .saved-close {
          background: #2563eb;
          color: white;
          border: none;
          padding: 0.75rem 2rem;
          border-radius: 8px;
          font-weight: 600;
          font-size: 0.95rem;
          cursor: pointer;
          transition: all 0.2s ease;
          font-family: inherit;
        }
        .saved-close:hover {
          background: #1d4ed8;
          transform: translateY(-1px);
          box-shadow: 0 2px 8px rgba(37, 99, 235, 0.2);
        }

        /* DETAIL MODAL */
        #detailOverlay {
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background: rgba(0, 0, 0, 0.5);
          backdrop-filter: blur(8px);
          display: none;
          align-items: center;
          justify-content: center;
          z-index: 1002;
          opacity: 0;
          transition: opacity 0.3s ease;
        }
        #detailOverlay.show {
          display: flex;
          opacity: 1;
        }
        .detail-card {
          background: white;
          border-radius: 16px;
          padding: 1.8rem;
          width: 90%;
          max-width: 420px;
          box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
          transform: scale(0.95);
          transition: transform 0.3s ease;
          position: relative;
        }
        #detailOverlay.show .detail-card {
          transform: scale(1);
        }
        .detail-close {
          position: absolute;
          top: 12px;
          right: 16px;
          background: none;
          border: none;
          font-size: 1.8rem;
          cursor: pointer;
          color: #666;
        }
        .detail-close:hover {
          color: #000;
        }
        .detail-header {
          font-size: 1.5rem;
          font-weight: 700;
          margin-bottom: 1.2rem;
          display: flex;
          align-items: center;
          gap: 0.8rem;
        }
        .detail-info {
          display: flex;
          align-items: center;
          gap: 0.8rem;
          font-size: 1.1rem;
          margin-bottom: 0.8rem;
        }
        .detail-eco-text {
          margin-top: 1rem;
          font-size: 0.95rem;
          color: #444;
          line-height: 1.5;
        }

        /* Category headings without single row */
        .category-column-heading {
          text-align: center;
          font-size: 1.1rem;
          margin: 0 0 0.5rem 0;
          font-weight: 600;
        }

        /* Error messages */
        .error-messages {
          color: red;
          font-size: 0.9rem;
          margin-top: 0.5rem;
        }
        /* DISCLAIMER FIX - Ab disclaimer box card ke andar relative rahega */
        .disclaimer-wrapper {
          margin-top: 1.5rem;
          display: flex;
          align-items: flex-start;
          gap: 0.75rem;
          position: relative; /* ye pehle se tha */
          width: 100%;
        }

        .info-circle {
          width: 20px;
          height: 20px;
          border: 1px solid;
          border-radius: 50%;
          background: #ffffff;
          color: #000000;
          font-weight: 600;
          font-size: 0.75rem;
          cursor: pointer;
          display: flex;
          align-items: center;
          justify-content: center;
          flex-shrink: 0;
          transition: background 0.2s ease;
          z-index: 2;
        }

        .info-circle:hover {
          background: #c7d2fe;
        }

        /* Yeh sabse important change hai */
        .disclaimer-box {
          background: #f8fafc;
          border: 1px solid #e5e7eb;
          border-radius: 10px;
          padding: 0.9rem 1.2rem;
          position: static; /* absolute se static kiya - ab card ke flow mein rahega */
          left: auto;
          top: auto;
          z-index: 1;
          min-width: auto;
          max-width: 100%;
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
          margin-top: 0.5rem;
          display: none; /* toggle ke liye */
        }

        .disclaimer-box.show {
          /* JS mein class add karenge */
          display: block;
        }

        /* RESULTS LAYOUT FIX - Dono sections same height */
        .results-main-row {
          display: flex;
          gap: 1.5rem;
          margin: 0.5rem 1rem 1.5rem 1rem;
          align-items: stretch; /* ye important - children ko full height stretch karega */
        }

        .providers-wrapper,
        .map-wrapper {
          display: flex;
          flex-direction: column;
          flex: 1;
        }

        /* Providers aur Map card dono full height le */
        .providers-wrapper > .card,
        .map-wrapper > .card {
          height: 100%;
          display: flex;
          flex-direction: column;
        }

        /* Map container ko remaining space le lene do */
        #mapContainer {
          flex: 1; /* ye map ko bacha hua saara space dega */
          min-height: 300px; /* minimum to avoid collapse */
          border-radius: 12px;
          overflow: hidden;
          background: #f3f4f6;
        }

        /* Card ke andar content stretch ho */
        .card {
          display: flex;
          flex-direction: column;
        }

        /* Providers list ko bhi flexible banao */
        #providersList {
          flex: 1;
          min-height: 200px;
        }

        /* Mobile pe column ho jaaye */
        @media (max-width: 900px) {
          .results-main-row {
            flex-direction: column;
          }
          .vertical-divider {
            display: none;
          }
          .map-wrapper > .card {
            height: auto;
          }
          #mapContainer {
            height: 400px;
          }
        }
        .map-wrapper > .card {
          height: auto; /* pehle 100% tha, ab auto */
          display: flex;
          flex-direction: column;
        }

        /* Map container flexible rahega */
        #mapContainer {
          flex: 1;
          min-height: 300px;
          border-radius: 12px;
          overflow: hidden;
          background: #f3f4f6;
        }

        /* Mobile fix same */
        @media (max-width: 900px) {
          .results-main-row {
            flex-direction: column;
          }
          .vertical-divider {
            display: none;
          }
          .map-wrapper > .card {
            height: auto;
          }
          #mapContainer {
            height: 400px;
          }
        }
        body.lock-scroll {
          height: 200vh;
          overflow: hidden;
          /* Yeh line add karo - prevents any layout shift when removing class */
          padding-right: var(--scrollbar-width, 0px);
        }
    </style>
</head>
<body class="lock-scroll">
<div id="bgHint">
    <div class="hint-title">
        DRAW YOUR OWN PATH WITH THIS INTERACTIVE BACKGROUND
        <span class="emoji">üòâ</span>
    </div>
    <div class="hint-sub">( left click to instantly erase path )</div>
</div>
<div class="app-shell">
    <header class="app-nav">
        <div class="app-brand">
            <img src="logo.svg" alt="FareComparator Logo" class="app-logo" />
        </div>
        <nav class="app-nav-links">
            <a href="index.html" class="active">Compare</a>
            <a href="history.html">History</a>
            <a href="analytics.html">Analytics</a>
            <a href="contact.html">Contact Us</a>
        </nav>
    </header>
    <main class="app-main">
        <section class="hero-section">
            <div id="world">
                <canvas id="trail-canvas"></canvas>
            </div>
            <div class="hero-box">
                <h1 class="hero-title">
                    CHOOSE YOUR RIDE WISELY<br />
                    WITH <span>RIDEVISE</span>
                </h1>
                <form id="heroForm" class="hero-form">
                    <div class="input-wrapper">
                        <svg
                                xmlns="http://www.w3.org/2000/svg"
                                width="20"
                                height="20"
                                fill="currentColor"
                                class="input-icon"
                                viewBox="0 0 16 16"
                        >
                            <path
                                    d="M12.166 8.94c-.524 1.062-1.234 2.12-1.96 3.07A32 32 0 0 1 8 14.58a32 32 0 0 1-2.206-2.57c-.726-.95-1.436-2.008-1.96-3.07C3.304 7.867 3 6.862 3 6a5 5 0 0 1 10 0c0 .862-.305 1.867-.834 2.94M8 16s6-5.686 6-10A6 6 0 0 0 2 6c0 4.314 6 10 6 10"
                            />
                            <path
                                    d="M8 8a2 2 0 1 1 0-4 2 2 0 0 1 0 4m0 1a3 3 0 1 0 0-6 3 3 0 0 0 0 6"
                            />
                        </svg>
                        <input
                                id="heroOrigin"
                                placeholder="Enter Pickup Location"
                                required
                        />
                    </div>
                    <div class="input-wrapper">
                        <svg
                                xmlns="http://www.w3.org/2000/svg"
                                width="20"
                                height="20"
                                fill="currentColor"
                                class="input-icon"
                                viewBox="0 0 16 16"
                        >
                            <path
                                    fill-rule="evenodd"
                                    d="M8 1a3 3 0 1 0 0 6 3 3 0 0 0 0-6M4 4a4 4 0 1 1 4.5 3.969V13.5a.5 0.5 0 0 1-1 0V7.97A4 4 0 0 1 4 3.999zm2.493 8.574a.5 0.5 0 0 1-.411.575c-.712.118-1.28.295-1.655.493a1.3 1.3 0 0 0-.37.265.3 0.3 0 0 0-.057.09V14l.002.008.016.033a.6 0.6 0 0 0 .145.15c.165.13.435.27.813.395.751.25 1.82.414 3.024.414s2.273-.163 3.024-.414c.378-.126.648-.265.813-.395a.6 0.6 0 0 0 .146-.15l.015-.033L12 14v-.004a.3 0.3 0 0 0-.057-.09 1.3 1.3 0 0 0-.37-.264c-.376-.198-.943-.375-1.655-.493a.5 0.5 0 1 1 .164-.986c.77.127 1.452.328 1.957.594C12.5 13 13 13.4 13 14c0 .426-.26.752-.544.977-.29.228-.68.413-1.116.558-.878.293-2.059.465-3.34.465s-2.462-.172-3.34-.465c-.436-.145-.826-.33-1.116-.558C3.26 14.752 3 14.426 3 14c0-.599.5-1 .961-1.243.505-.266 1.187-.467 1.957-.594a.5 0.5 0 0 1 .575.411"
                            />
                        </svg>
                        <input
                                id="heroDestination"
                                placeholder="Enter Drop Location"
                                required
                        />
                    </div>
                    <div class="input-wrapper">
                        <svg
                                xmlns="http://www.w3.org/2000/svg"
                                width="20"
                                height="20"
                                fill="currentColor"
                                class="input-icon"
                                viewBox="0 0 16 16"
                        >
                            <path
                                    d="M3 14s-1 0-1-1 1-4 6-4 6 3 6 4-1 1-1 1zm5-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6"
                            />
                        </svg>
                        <input
                                id="heroUserId"
                                placeholder="Enter UserID if you want to save your data"
                        />
                    </div>
                    <button type="submit" class="btn btn-primary hero-btn">
                        Find Ride
                    </button>
                </form>
            </div>
        </section>
        <section id="resultsSection">
            <!-- Main row with Providers + Divider + Map -->
            <div class="results-main-row">
                <div class="providers-wrapper">
                    <section class="card" id="resultsCard">
                        <div class="card-header">
                            <div>
                                <h2 class="card-title">Providers</h2>
                                <p
                                        id="metaLine"
                                        class="text-muted"
                                        style="
                        font-size: 1.2rem;
                        font-weight: 700;
                        color: #111827;
                      "
                                >
                                    Enter locations above and compare
                                </p>
                            </div>
                            <span class="badge" id="resultsCount">0</span>
                        </div>
                        <div id="categoryHeadings"></div>
                        <div id="providersList" class="columns-grid">
                            <div
                                    class="text-muted"
                                    style="padding: 1rem; grid-column: 1 / -1"
                            >
                                Enter pickup & drop location above to compare fares.
                            </div>
                        </div>
                        <div
                                class="confirm-wrapper"
                                style="text-align: right; margin-top: 1rem"
                        >
                            <button id="confirmChoiceBtn" class="btn btn-primary">
                                Confirm Choice
                            </button>
                            <div id="errorMessages" class="error-messages"></div>
                        </div>
                        <div class="disclaimer-wrapper">
                            <button
                                    id="toggleDisclaimer"
                                    class="info-circle"
                                    type="button"
                            >
                                i
                            </button>
                            <div id="disclaimerBox" class="disclaimer-box">
                                <ul>
                                    <li>
                                        All prices and estimates shown are approximate and based
                                        on calculated or observed data. 100% accuracy is not
                                        guaranteed.
                                    </li>
                                    <li>
                                        Further improvements can be made by introducing a common
                                        login system to authenticate users directly with
                                        providers and use official APIs.
                                    </li>
                                    <li>
                                        Exact distance calculation requires valid API keys
                                        configured via environment variables(currently
                                        unavailable). Mock distances are used for demo purposes.
                                    </li>
                                    <li>
                                        Metro options are displayed only when the selected
                                        origin and destination match valid metro stations or
                                        supported routes.
                                    </li>
                                    <li>
                                        Prices are calculated purely based on distance and do
                                        not guarantee ride availability without direct provider
                                        authentication (currently unavailable).
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </section>
                </div>
                <div class="vertical-divider"></div>
                <div class="map-wrapper">
                    <section class="card">
                        <div class="card-header">
                            <h2 class="card-title">Route Preview</h2>
                            <span class="chip">Google Maps</span>
                        </div>
                        <div
                                id="mapContainer"
                                style="
                    width: 100%;
                    height: 320px;
                    border-radius: 12px;
                    background: #f3f4f6;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    color: #6b7280;
                    font-size: 0.9rem;
                  "
                        >
                            Map preview will appear here after search
                        </div>
                    </section>
                </div>
            </div>

            <!-- Quick Demo section below everything, centered -->
            <div class="quick-demo-section">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Quick Demo</h2>
                        <p class="text-muted">Click to auto-fill sample routes</p>
                    </div>
                    <div class="demo-buttons">
                        <button
                                class="btn btn-secondary demo-btn"
                                data-origin="New Delhi"
                                data-destination="Rajiv Chowk"
                        >
                            New Delhi ‚Üí Rajiv Chowk
                        </button>
                        <button
                                class="btn btn-secondary demo-btn"
                                data-origin="New Delhi"
                                data-destination="Karol Bagh"
                        >
                            New Delhi ‚Üí Karol Bagh
                        </button>
                        <button
                                class="btn btn-secondary demo-btn"
                                data-origin="Mumbai"
                                data-destination="Thane"
                        >
                            Mumbai ‚Üí Thane
                        </button>
                        <button
                                class="btn btn-secondary demo-btn"
                                data-origin="New Delhi"
                                data-destination="Noida"
                        >
                            New Delhi ‚Üí Noida
                        </button>
                    </div>
                </div>
            </div>
        </section>
    </main>
</div>

<!-- Choice Saved Animation -->
<div id="choiceSavedOverlay">
    <div class="saved-card">
        <div class="saved-icon">‚úì</div>
        <div class="saved-title">Choice Confirmed</div>
        <div class="saved-details" id="savedDetails"></div>
        <button class="saved-close" id="closeSaved">Close</button>
    </div>
</div>

<!-- Detail Modal -->
<div id="detailOverlay">
    <div class="detail-card">
        <button class="detail-close">√ó</button>
        <div class="detail-header" id="detailHeader"></div>
        <div id="detailBody"></div>
    </div>
</div>

<script>
    const API_BASE =
      window.location.hostname === "localhost"
        ? ""
        : "https://ridevise-backend.onrender.com";
    const providersList = document.getElementById("providersList");
    const categoryHeadings = document.getElementById("categoryHeadings");
    const metaLine = document.getElementById("metaLine");
    const resultsCount = document.getElementById("resultsCount");
    const mapContainer = document.getElementById("mapContainer");
    const confirmChoiceBtn = document.getElementById("confirmChoiceBtn");
    const errorMessages = document.getElementById("errorMessages");
    const choiceSavedOverlay = document.getElementById("choiceSavedOverlay");
    const savedDetails = document.getElementById("savedDetails");
    const closeSavedBtn = document.getElementById("closeSaved");
    const detailOverlay = document.getElementById("detailOverlay");
    const detailHeader = document.getElementById("detailHeader");
    const detailBody = document.getElementById("detailBody");

    // Critical elements for height sync
    const providersCard = document.querySelector("#resultsCard");
    const mapCard = document.querySelector(".map-wrapper > .card");
    const disclaimerBox = document.getElementById("disclaimerBox");

    let selectedProviderId = null;
    let lastRequestPayload = null;
    let lastSnapshotId = null;
    let currentProvidersData = [];
    let hasMetroOrWalk = false;

    // Yeh store karega disclaimer band hone wali fixed height
    let fixedProvidersHeight = null;
    window.addEventListener('load', () => {
// 1. Inputs restore karo
const savedOrigin = localStorage.getItem('lastOrigin');
const savedDestination = localStorage.getItem('lastDestination');
const savedUserId = localStorage.getItem('lastUserId');

if (savedOrigin) document.getElementById('heroOrigin').value = savedOrigin;
if (savedDestination) document.getElementById('heroDestination').value = savedDestination;
if (savedUserId) document.getElementById('heroUserId').value = savedUserId;

// 2. Background, trail aur HINT ka logic
const hasPreviousSearch = savedOrigin && savedDestination;

if (hasPreviousSearch) {
  // Pehle search kiya tha ‚Üí background + trail + HINT sab dikhao
  document.getElementById("world")?.classList.remove("hide");
  document.getElementById("bgHint")?.classList.remove("hide");  // ‚Üê Hint dikhao
} else {
  // Bilkul fresh visit ‚Üí sab already dikhega (default mein hai)
  document.getElementById("world")?.classList.remove("hide");
  document.getElementById("bgHint")?.classList.remove("hide");
}
delete window.stopTrail;
// 3. Results restore (agar the toh)
const savedState = sessionStorage.getItem('lastCompareState');
if (savedState) {
  const { payload, data } = JSON.parse(savedState);

  lastRequestPayload = payload;
  lastSnapshotId = data.snapshotId;
  currentProvidersData = data.sortedFares || [];

  metaLine.textContent = `Distance: ${data.totalDistanceKm ?? "-"} km`;
  metaLine.style.fontSize = "1.2rem";
  metaLine.style.fontWeight = "700";
  metaLine.style.color = "#111827";
  resultsCount.textContent = data.sortedFares?.length || 0;

  renderProviders(data.sortedFares || [], data.recommendation?.chosenProviderId || null, data.totalDistanceKm);
  updateRouteMap(payload.origin, payload.destination);

  document.body.classList.remove("lock-scroll");
  document.getElementById("resultsSection").scrollIntoView({ behavior: "smooth" });
  setTimeout(syncMapHeight, 300);
}
});

    function formatCO2(p) {
      const co2 = p?.metadata?.co2EmissionKg;
      if (typeof co2 !== "number") return "-";
      return `${co2.toFixed(2)} kg`;
    }

    // Final height sync function - map ki height hamesha fixed rahegi
    function syncMapHeight() {
      if (!providersCard || !mapCard) return;

      const isDisclaimerOpen = disclaimerBox.classList.contains("show");

      // Jab disclaimer band ho ‚Üí uski height capture kar lo (fixed karne ke liye)
      if (!isDisclaimerOpen && fixedProvidersHeight === null) {
        fixedProvidersHeight = providersCard.offsetHeight;
      }

      // Hamesha fixed height lagao map pe (agar capture ho chuki hai)
      if (fixedProvidersHeight !== null) {
        mapCard.style.height = fixedProvidersHeight + "px";
        mapCard.style.minHeight = fixedProvidersHeight + "px";
      }
    }

    async function doCompare(payload) {
      providersList.innerHTML =
        '<div class="text-muted" style="padding:1rem; grid-column: 1 / -1;">Loading providers...</div>';
      categoryHeadings.innerHTML = "";
      selectedProviderId = null;
      hasMetroOrWalk = false;
      fixedProvidersHeight = null; // Nayi search pe reset

      try {
        const res = await fetch(API_BASE + "/api/v1/compare", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload),
        });
        if (!res.ok) throw new Error("HTTP " + res.status);
        const data = await res.json();
        lastSnapshotId = data.snapshotId;
        currentProvidersData = data.sortedFares || [];
        metaLine.textContent = `Distance: ${data.totalDistanceKm ?? "-"} km`;
        metaLine.style.fontSize = "1.2rem";
        metaLine.style.fontWeight = "700";
        metaLine.style.color = "#111827";
        resultsCount.textContent = data.sortedFares?.length || 0;
        renderProviders(
          data.sortedFares || [],
          data.recommendation?.chosenProviderId || null,
          data.totalDistanceKm
        );
        updateRouteMap(payload.origin, payload.destination);

        // Results load hone ke baad height capture karo
        setTimeout(syncMapHeight, 300);
        sessionStorage.setItem('lastCompareState', JSON.stringify({
payload: payload,
data: data,
selectedProviderId: selectedProviderId,
hasMetroOrWalk: hasMetroOrWalk
}));
      } catch (err) {
        console.error(err);
        providersList.innerHTML =
          '<div class="text-muted" style="padding:1rem; grid-column: 1 / -1;">Service temporarily unavailable.</div>';
      }
    }

    function renderProviders(
      sortedFares = [],
      recommendedId = null,
      totalDistanceKm = null
    ) {
      let fastestProviderId = null;
      let minEta = Infinity;
      sortedFares.forEach((p) => {
        if (typeof p.etaMinutes === "number" && p.etaMinutes < minEta) {
          minEta = p.etaMinutes;
          fastestProviderId = p.providerId;
        }
      });

      providersList.innerHTML = "";
      categoryHeadings.innerHTML = "";
      providersList.className = "columns-grid";

      if (!sortedFares || sortedFares.length === 0) {
        providersList.innerHTML =
          '<div class="text-muted" style="padding:1rem; grid-column: 1 / -1;">No providers available for this route.</div>';
        return;
      }

      let groups = { bike: [], auto: [], car: [], metro: [] };
      let walkOption = null;
      sortedFares.forEach((p) => {
        let type = (p.vehicleType || p.vehicle_type || "").toLowerCase();
        if (type.includes("bike")) groups.bike.push(p);
        else if (type.includes("auto") || type.includes("rickshaw"))
          groups.auto.push(p);
        else if (
          type.includes("car") ||
          type.includes("cab") ||
          type.includes("sedan") ||
          type.includes("prime")
        )
          groups.car.push(p);
        else if (type.includes("metro")) groups.metro.push(p);
        else if (type.includes("walk")) walkOption = p;
      });

      hasMetroOrWalk =
        groups.metro.length > 0 || (walkOption && totalDistanceKm <= 3);

      Object.keys(groups).forEach((key) =>
        groups[key].sort((a, b) => a.price - b.price)
      );
      sortedFares.forEach((p) => {
        // Remove "(Mock)" from all provider names
        p.displayName = p.providerName.replace(/\s*\(Mock\)/gi, "");

        // For car providers, remove "Economy Cab" and "Premium Cab" from display name
        const type = (p.vehicleType || p.vehicle_type || "").toLowerCase();
        if (
          type.includes("car") ||
          type.includes("cab") ||
          type.includes("sedan") ||
          type.includes("prime")
        ) {
          p.displayName = p.displayName.replace(/\s*\(Economy Cab\)/gi, "");
          p.displayName = p.displayName.replace(/\s*\(Premium Cab\)/gi, "");
        }
      });

      const categories = [
        { key: "bike", title: "Bike", emoji: "üèçÔ∏è" },
        { key: "auto", title: "Auto", emoji: "üõ∫" },
        { key: "car", title: "Car", emoji: "üöó" },
        { key: "metro", title: "Metro", emoji: "üöá" },
      ];

      const availableCategories = categories.filter(
        (cat) =>
          groups[cat.key].length > 0 ||
          (cat.key === "metro" && walkOption && totalDistanceKm <= 3)
      );

      const gridTemplateColumns = availableCategories
        .map(() => "1fr")
        .join(" ");
      providersList.style.gridTemplateColumns =
        gridTemplateColumns || "repeat(auto-fit, minmax(140px, 1fr))";

      providersList.style.justifyItems = "stretch";
      providersList.style.alignItems = "start";

      availableCategories.forEach((cat, index) => {
        if (
          groups[cat.key].length === 0 &&
          !(cat.key === "metro" && walkOption && totalDistanceKm <= 3)
        ) {
          return;
        }

        const col = document.createElement("div");
        col.style.display = "flex";
        col.style.flexDirection = "column";
        col.style.alignItems = "stretch";
        col.style.gap = "0.6rem";

        const head = document.createElement("div");
        head.className = "category-column-heading";
        head.textContent = `${cat.emoji} ${cat.title}`;
        if (cat.key === "metro" && walkOption && totalDistanceKm <= 3) {
          head.textContent += "/Walk";
        }
        col.appendChild(head);

        groups[cat.key].forEach((p) => {
          const el = document.createElement("div");
          el.className = "provider-card";
          el.dataset.providerId = p.providerId;
          el.dataset.providerData = JSON.stringify(p);
          let surgeHtml = p.isSurge ? '<div class="surge">Surge</div>' : "";

          // Use displayName instead of providerName
              const vehicleTypeLower = (p.vehicleType || p.vehicle_type || '').toLowerCase();
  const isMetro = vehicleTypeLower.includes('metro');

  let etaHtml = '';
  if (!isMetro) {
      etaHtml = `<div class="eta">${p.etaMinutes ?? '-'} mins away</div>`;
  }

  el.innerHTML = `
      ${surgeHtml}
      <div class="provider-name">
          ${escapeHtml(p.displayName || p.providerName)}
          ${p.providerId === recommendedId ? '<span class="best-badge">Best Choice</span>' : ''}
          ${p.providerId === fastestProviderId ? '<span class="fastest-icon" title="Fastest option">Fastest</span>' : ''}
      </div>
      <div class="fare">‚Çπ ${Number(p.price).toFixed(2)}</div>
      ${etaHtml}
  `;
          col.appendChild(el);
        });

        if (cat.key === "metro" && walkOption && totalDistanceKm <= 3) {
          const el = document.createElement("div");
          el.className = "provider-card walk";
          el.dataset.providerId = walkOption.providerId;
          el.dataset.providerData = JSON.stringify(walkOption);
          el.innerHTML = `
                  <div class="provider-name">Walk üå±</div>
                  <div class="text-muted" style="font-size:0.85rem;">Eco-friendly & Healthy</div>
              `;
          col.appendChild(el);
        }

        if (col.children.length > 0) {
          providersList.appendChild(col);
        }
      });

      const cards = providersList.querySelectorAll(".provider-card");
      cards.forEach((card) => {
        card.style.width = "100%";
        card.style.flex = "0 0 auto";
      });

      // Render ke baad height sync
      setTimeout(syncMapHeight, 100);
    }

    function escapeHtml(s) {
      return String(s || "").replace(
        /[&<>"']/g,
        (m) =>
          ({
            "&": "&amp;",
            "<": "&lt;",
            ">": "&gt;",
            '"': "&quot;",
            "'": "&#39;",
          }[m])
      );
    }

    providersList.addEventListener("click", (e) => {
      const card = e.target.closest(".provider-card");
      if (!card) return;

      const providerId = card.dataset.providerId;
      const data = JSON.parse(card.dataset.providerData || "{}");

      if (selectedProviderId === providerId) {
        selectedProviderId = null;
        card.classList.remove("selected");
      } else {
        selectedProviderId = providerId;
        document
          .querySelectorAll(".provider-card")
          .forEach((c) => c.classList.remove("selected"));
        card.classList.add("selected");
      }

      showDetailModal(data);
    });

    // showDetailModal function mein yeh changes karo:

    function showDetailModal(p) {
      let typeEmoji = "üöó";
      let category = "";
      const type = (p.vehicleType || p.vehicle_type || "").toLowerCase();

      if (type.includes("bike")) {
        typeEmoji = "üèçÔ∏è";
        category = "Bike Taxi";
      } else if (type.includes("auto") || type.includes("rickshaw")) {
        typeEmoji = "üõ∫";
        category = "Auto Rickshaw";
      } else if (type.includes("metro")) {
        typeEmoji = "üöá";
        category = "Metro Rail";
      } else if (type.includes("walk")) {
        typeEmoji = "üö∂";
        category = "Walking";
      } else if (type.includes("car") || type.includes("cab")) {
        const providerNameLower = (p.providerName || "").toLowerCase();
        const displayNameLower = (
          p.displayName ||
          p.providerName ||
          ""
        ).toLowerCase();

        // Check if it's Ola Prime or clearly premium
        if (
          providerNameLower.includes("prime") ||
          providerNameLower.includes("premier") ||
          providerNameLower.includes("premium") ||
          displayNameLower.includes("prime")
        ) {
          category = "Premium Cab";
        }
        // Special handling for Uber: compare prices among all Uber options
        else if (
          providerNameLower.includes("uber") ||
          displayNameLower.includes("uber")
        ) {
          // Find all Uber providers from current data
          const uberProviders = currentProvidersData.filter((prov) => {
            const name = (
              prov.providerName ||
              prov.displayName ||
              ""
            ).toLowerCase();
            return name.includes("uber");
          });

          if (uberProviders.length >= 2) {
            // Get the highest price among Uber options
            const maxUberPrice = Math.max(
              ...uberProviders.map((prov) => Number(prov.price || 0))
            );

            // If current provider has the highest price ‚Üí Premium
            if (Number(p.price) === maxUberPrice) {
              category = "Premium Cab";
            } else {
              category = "Economy Cab";
            }
          } else {
            // Only one Uber ‚Üí treat as Economy
            category = "Economy Cab";
          }
        } else {
          // Default for other car providers (like Ola Mini, etc.)
          category = "Economy Cab";
        }
      }

      // Clean display name (remove old parentheses if any)
      const displayName = p.displayName || p.providerName || "Unknown";

      detailHeader.innerHTML = `${typeEmoji} ${escapeHtml(
        displayName
      )} <span style="font-weight:400; color:#666;">(${category})</span>`;

      // ... baaki code same rahega (CO2, eco text, arrival time hide for walk, etc.)

      const co2 = formatCO2(p);
      const isEco = co2.includes("-") ? false : parseFloat(co2) <= 50;
      const co2Emoji = isEco ? "üå±" : "üå°Ô∏è";

      // Eco-friendly message for Metro and Walk
      let ecoText = "";
      if (type.includes("metro")) {
        ecoText = `Taking the metro is the most eco-friendly option with virtually zero direct CO2 emissions.`;
      } else if (type.includes("walk")) {
        ecoText = `Walking is the healthiest and most eco-friendly option with zero CO2 emissions.`;
      } else {
        ecoText = isEco
          ? `This ${category.toLowerCase()} option has relatively lower CO2 emissions.`
          : `This ${category.toLowerCase()} option has higher CO2 emissions. Consider greener options if available.`;
      }

      let arrivalLine = "";
      if (!type.includes("walk") && !type.includes("metro")) {
        arrivalLine = `<div class="detail-info">‚è±Ô∏è Arrival Time: <strong>${
          p.etaMinutes ?? "-"
        } minutes</strong></div>`;
      }
      detailBody.innerHTML = `
      <div class="detail-info">üí∞ Fare: <strong>‚Çπ ${Number(p.price).toFixed(
        2
      )}</strong></div>
      ${arrivalLine}
      <div class="detail-info">${co2Emoji} CO2 Emission: <strong>${co2}</strong></div>
      <div class="detail-eco-text">${ecoText}</div>
  `;

      detailOverlay.classList.add("show");
    }

    document.querySelector(".detail-close").addEventListener("click", () => {
      detailOverlay.classList.remove("show");
    });

    detailOverlay.addEventListener("click", (e) => {
      if (e.target === detailOverlay) detailOverlay.classList.remove("show");
    });

    let scrollUnlocked = false;
    document.getElementById("heroForm").addEventListener("submit", (e) => {
      e.preventDefault();
      const origin = document.getElementById("heroOrigin").value.trim();
      const destination = document
        .getElementById("heroDestination")
        .value.trim();
      const userId =
        document.getElementById("heroUserId").value.trim() || null;
      if (!origin || !destination) return;

      // Background hide karo
      // document.getElementById("world")?.classList.add("hide");
      // window.stopTrail?.();
      // document.getElementById("bgHint")?.classList.add("hide");
      if (userId) {
localStorage.setItem('userId', userId);
}
      const payload = {
        userId,
        origin,
        destination,
        departureTime: null,
        preferCheapest: true,
        preferFastest: false,
      };
      localStorage.setItem('lastOrigin', origin);
localStorage.setItem('lastDestination', destination);
if (userId) {
localStorage.setItem('lastUserId', userId);
}
      lastRequestPayload = payload;
      doCompare(payload);

      // === YEH NAYA FIX HAI ===
      const resultsSection = document.getElementById("resultsSection");

      // Pehle scroll karo (body abhi lock-scroll mein hai - no shift)
      resultsSection.scrollIntoView({ behavior: "smooth" });

      // Scroll complete hone ke baad lock-scroll hatao
      const removeLock = () => {
        if (!scrollUnlocked) {
          // Scrollbar width calculate karo (only once)
          const scrollbarWidth =
            window.innerWidth - document.documentElement.clientWidth;
          document.documentElement.style.setProperty(
            "--scrollbar-width",
            `${scrollbarWidth}px`
          );

          document.body.classList.remove("lock-scroll");
          scrollUnlocked = true;

          // Event listeners hatao
          window.removeEventListener("scrollend", removeLock);
          clearTimeout(fallbackTimeout);
        }
      };

      // Modern browsers: scrollend event (perfect)
      window.addEventListener("scrollend", removeLock, { once: true });

      // Fallback for older browsers ya agar scrollend na ho
      const fallbackTimeout = setTimeout(removeLock, 1000); // 1 second max wait
    });

    confirmChoiceBtn.addEventListener("click", async () => {
      errorMessages.innerHTML = "";
      let errors = [];
      if (!lastRequestPayload?.userId)
        errors.push("Enter UserID to save choices");
      if (!selectedProviderId)
        errors.push("Please select a option before confirming");
      if (errors.length > 0) {
        errorMessages.innerHTML = errors
          .map((err) => `<p>${err}</p>`)
          .join("");
        return;
      }
      if (!lastSnapshotId) return;

      const selectedProvider = currentProvidersData.find(
        (p) => p.providerId === selectedProviderId
      );
      const payload = {
        userId: lastRequestPayload.userId,
        origin: lastRequestPayload.origin,
        destination: lastRequestPayload.destination,
        departureTime: lastRequestPayload.departureTime,
        snapshotId: lastSnapshotId,
        chosenProviderId: selectedProviderId,
      };

      try {
        const res = await fetch(API_BASE + "/api/v1/compare/choose", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload),
        });

        if (res.ok) {
          document
            .querySelectorAll(".provider-card")
            .forEach((c) => c.classList.remove("selected"));
          document
            .querySelector(
              `.provider-card[data-provider-id="${selectedProviderId}"]`
            )
            ?.classList.add("confirmed");

          const rawName = selectedProvider?.providerName || selectedProviderId || 'Unknown';
const providerName = escapeHtml(rawName.replace(/\s*\(Mock\)/gi, '').trim());
          const price = Number(selectedProvider?.price || 0).toFixed(2);
          const origin = escapeHtml(lastRequestPayload.origin);
          const destination = escapeHtml(lastRequestPayload.destination);

          // Pehle vehicle type detect karo
const vehicleType = (selectedProvider?.vehicleType || selectedProvider?.vehicle_type || '').toLowerCase();

let vehicleLine = '';
if (vehicleType.includes('bike')) {
  vehicleLine = '<div style="margin-bottom: 1rem; color: #374151; font-size: 1rem;">Vehicle: Bike</div>';
} else if (vehicleType.includes('auto') || vehicleType.includes('rickshaw')) {
  vehicleLine = '<div style="margin-bottom: 1rem; color: #374151; font-size: 1rem;">Vehicle: Auto Rickshaw</div>';
} else if (vehicleType.includes('car') || vehicleType.includes('cab') || vehicleType.includes('sedan') || vehicleType.includes('prime')) {
  vehicleLine = '<div style="margin-bottom: 1rem; color: #374151; font-size: 1rem;">Vehicle: Car</div>';
}
// Metro aur Walk ke liye kuch nahi ‚Äî vehicleLine khali rahega

savedDetails.innerHTML = `
  <div style="margin-bottom: 0.8rem; font-size: 1.1rem; font-weight: 500;">
      ${providerName} - ‚Çπ${price}
  </div>
  ${vehicleLine}
  <div style="margin-bottom: 1rem; color: #6b7280;">
      ${origin} ‚Üí ${destination}
  </div>
  <div style="font-size: 0.9rem; color: #4b5563;">
      Your choice has been saved to your history.
  </div>
`;
          choiceSavedOverlay.classList.add("show");
        }
      } catch (e) {
        console.error(e);
        alert("Error saving choice.");
      }
    });

    closeSavedBtn.addEventListener("click", () => {
      choiceSavedOverlay.classList.remove("show");
    });

    choiceSavedOverlay.addEventListener("click", (e) => {
      if (!e.target.closest(".saved-card"))
        choiceSavedOverlay.classList.remove("show");
    });

    document.querySelectorAll(".demo-btn").forEach((btn) => {
      btn.addEventListener("click", () => {
        document.getElementById("heroOrigin").value = btn.dataset.origin;
        document.getElementById("heroDestination").value =
          btn.dataset.destination;
        document
          .getElementById("heroForm")
          .dispatchEvent(new Event("submit"));
      });
    });

    // Disclaimer toggle - sirf toggle karega, height fixed rahegi
    document
      .getElementById("toggleDisclaimer")
      .addEventListener("click", () => {
        disclaimerBox.classList.toggle("show");
        setTimeout(syncMapHeight, 150);
      });

    function updateRouteMap(origin, destination) {
      if (!origin || !destination) return;
      const iframe = document.createElement("iframe");
      iframe.width = "100%";
      iframe.height = "100%";
      iframe.style.border = "0";
      iframe.loading = "lazy";
      iframe.src = `https://www.google.com/maps?q=${encodeURIComponent(
        origin + " to " + destination
      )}&output=embed`;
      mapContainer.innerHTML = "";
      mapContainer.appendChild(iframe);

      setTimeout(syncMapHeight, 500);
    }

    // Resize pe bhi sync
    window.addEventListener("resize", () => {
      setTimeout(syncMapHeight, 100);
    });

    // Page load pe initial sync
    window.addEventListener("load", () => {
      setTimeout(syncMapHeight, 500);
    });

    // Background interactive trail animation
    // Background interactive trail animation - FIXED VERSION
(function () {
const canvas = document.getElementById("trail-canvas");
if (!canvas) return;

const ctx = canvas.getContext("2d");
let trails = [];
const dpr = window.devicePixelRatio || 1;
let stopAnimate = false;

function resize() {
  canvas.width = window.innerWidth * dpr;
  canvas.height = window.innerHeight * dpr;
  canvas.style.width = "100%";
  canvas.style.height = "100%";
  ctx.scale(dpr, dpr);
}

window.addEventListener("resize", resize);
resize();

const bgImage = new Image();
bgImage.src = "bg.jpg";

let isMoving = false;

window.addEventListener("mousemove", (e) => {
  const rect = canvas.getBoundingClientRect();
  const mouseX = (e.clientX - rect.left) * (canvas.width / rect.width);
  const mouseY = (e.clientY - rect.top) * (canvas.height / rect.height);
  isMoving = true;

  if (
    trails.length === 0 ||
    Math.hypot(
      trails[trails.length - 1].x - mouseX / dpr,
      trails[trails.length - 1].y - mouseY / dpr
    ) > 8
  ) {
    trails.push({ x: mouseX / dpr, y: mouseY / dpr, age: 0 });
  }
});

function animate() {
  if (stopAnimate) return;

  ctx.clearRect(0, 0, canvas.width / dpr, canvas.height / dpr);
  ctx.drawImage(bgImage, 0, 0, canvas.width / dpr, canvas.height / dpr);

  if (trails.length > 1) {
    ctx.lineWidth = 2.5;
    ctx.setLineDash([10, 12]);
    ctx.lineDashOffset = (-Date.now() / 40) % 22;
    ctx.lineCap = "round";
    ctx.lineJoin = "round";

    for (let i = trails.length - 2; i >= 0; i--) {
      const progressFromTail = (trails.length - 2 - i) / (trails.length - 2);
      const opacity = 1 - progressFromTail;
      ctx.strokeStyle = `rgba(100, 130, 160, ${opacity * 0.8})`;
      ctx.beginPath();
      ctx.moveTo(trails[i].x, trails[i].y);
      ctx.lineTo(trails[i + 1].x, trails[i + 1].y);
      ctx.stroke();
    }
  }

  trails = trails.filter((p) => {
    p.age++;
    return p.age < 70;
  });

  if (!isMoving && trails.length > 0) {
    trails.forEach((p) => (p.age += 4));
  }

  requestAnimationFrame(animate);
}

// üî• YEHI MAIN FIX HAI
// Image load hone pe animate start karo
bgImage.onload = () => {
  animate();
};

// Agar image already cached hai toh onload nahi chalega ‚Üí force start
if (bgImage.complete && bgImage.naturalWidth > 0) {
  animate();
}

// Left click se clear
window.addEventListener("click", () => {
  trails = [];
});

// Safety: agar koi purana stopTrail function hai toh hata do
delete window.stopTrail;
})();

</script>
</body>
</html>
